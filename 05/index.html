<html>
    <head>
        <style>
            html, body {
                background-color: black;
                margin: 0;
                padding: 0%;
                height: 100%;
                overflow: hidden;
            }
        </style>

        <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

        <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@latest/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@latest/examples/jsm/"
            }
        }
        </script>

        <script type="module">
 
            // part 3-1,3-3,3-8
            import * as THREE from 'three';
            import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
            import { AnaglyphEffect } from 'three/addons/effects/AnaglyphEffect.js';
            import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
            import {Pane} from 'https://cdn.jsdelivr.net/npm/tweakpane@4.0.5/dist/tweakpane.min.js';
        
            var renderer, controls, scene, camera, effect;
            var loader, loader2, pane, q;

            window.onload = function() {

                scene = new THREE.Scene();

                var fov = 75;
                var ratio = window.innerWidth / window.innerHeight;
                var zNear = 0.1;
                var zFar = 10000;
                camera = new THREE.PerspectiveCamera( fov, ratio, zNear, zFar );
                // part 3-4
                camera.position.set(0, 0, 10);

                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize( window.innerWidth, window.innerHeight );
                document.body.appendChild( renderer.domElement );


                // part 3-2
                var ambientLight = new THREE.AmbientLight();
                scene.add( ambientLight );
        
                var light = new THREE.DirectionalLight( 0xffffff, 5.0 );
                light.position.set( 10, 100, 10 );
                scene.add( light );

                controls = new OrbitControls( camera, renderer.domElement );

                effect = new AnaglyphEffect( renderer );
                effect.setSize( window.innerWidth, window.innerHeight );

                // part 3-3,3-4
                loader = new GLTFLoader();
                loader.load( 'poly.glb', function ( gltf ) {

                    scene.add( gltf.scene );

                    var poly = gltf.scenes[0].children[0];

                    poly.scale.x = 20;
                    poly.scale.y = 20;
                    poly.scale.z = 20;
                    
                    // part 3-6
                    poly.quaternion.w = 1;
                    poly.quaternion.x = 0;
                    poly.quaternion.y = 0;
                    poly.quaternion.z = 0;

                    poly.position.set (-7, -10, 0);

                    poly.translateX(5);

                    // part 3-10
                    window.SCENE.poly = poly;

                    var polyui = pane.addFolder({title: 'PolyCam Mesh'});
                    polyui.addBinding(window.SCENE.poly.material, 'wireframe');

                    polyui.addButton({title:'rotate!'}).on('click', () => {
                        window.SCENE.do_rotate_poly();
                    });

                } );

                // part 3-5
                loader2 = new GLTFLoader();
                loader2.load( 'Teddy.glb', function ( gltf ) {

                    scene.add( gltf.scene );

                    var teddy = gltf.scenes[0].children[0];

                    teddy.scale.x = 20;
                    teddy.scale.y = 20;
                    teddy.scale.z = 20;

                    // part 3-6
                    teddy.quaternion.w = 1;
                    teddy.quaternion.x = 0;
                    teddy.quaternion.y = 0;
                    teddy.quaternion.z = 0;

                    teddy.position.set (-7, -10, 0);

                } );

                // part 3-8
                pane = new Pane();
                var sceneui = pane.addFolder({title: 'Scene'});

                //
                // SETTINGS and HELPER for TWEAKPANE
                //
                window['SCENE'] = {
   
                    'anaglyph': false,
                    'poly': null,
                    'rotate_poly': false,
                    'do_rotate_poly': function() {
                        window['SCENE']['rotate_poly'] = !window['SCENE']['rotate_poly'];
                    },

                }

                sceneui.addBinding(window.SCENE, 'anaglyph');

                sceneui.addBinding(light.position, 'x', {min:-100, max:100, label:'Light X'});
                sceneui.addBinding(light.position, 'y', {min:-100, max:100, label:'Light Y'});
                sceneui.addBinding(light.position, 'z', {min:-100, max:100, label:'Light Z'});

                sceneui.addBinding(light, 'intensity', {min:0, max:10, label:'Intensity'});

                sceneui.addBinding(ambientLight, 'color', {label:'AmbientLight Color'});
                


                animate();

            };

            function animate() {

                requestAnimationFrame( animate );

                controls.update();

                // part 3-9
                if (window.SCENE.anaglyph) {
                    effect.render( scene, camera );
                } else {
                    renderer.render( scene, camera );
                }

                // part 3-10
                if (window.SCENE.poly) {
                    q = new THREE.Quaternion();
                    if (window.SCENE.rotate_poly) {
                        q.setFromAxisAngle(new THREE.Vector3(0,1,0), Math.PI);
                        window.SCENE.poly.quaternion.slerp( q, 0.01 );

                    } else {
                        q.identity();
                        window.SCENE.poly.quaternion.slerp( q, 0.01 );
                    }
                }

            };

        </script>
    </head>
    <body></body>
</html>